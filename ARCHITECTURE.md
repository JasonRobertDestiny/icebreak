# IceBreak AI - ç³»ç»Ÿæ¶æ„æ–‡æ¡£

**ç‰ˆæœ¬**: 1.0  
**æ—¥æœŸ**: 2025-11-01  
**çŠ¶æ€**: MVP (Day 5)

---

## ç›®å½•

1. [ç³»ç»Ÿæ¦‚è§ˆ](#ç³»ç»Ÿæ¦‚è§ˆ)
2. [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
3. [æ¶æ„å†³ç­–](#æ¶æ„å†³ç­–)
4. [æ ¸å¿ƒæ¨¡å—](#æ ¸å¿ƒæ¨¡å—)
5. [æ•°æ®æµ](#æ•°æ®æµ)
6. [APIè®¾è®¡](#apiè®¾è®¡)
7. [ç»„ä»¶å±‚çº§](#ç»„ä»¶å±‚çº§)
8. [éƒ¨ç½²æ¶æ„](#éƒ¨ç½²æ¶æ„)
9. [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
10. [å®‰å…¨è€ƒè™‘](#å®‰å…¨è€ƒè™‘)

---

## ç³»ç»Ÿæ¦‚è§ˆ

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      IceBreak AI                             â”‚
â”‚                    (Next.js 16 App)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚          å®¢æˆ·ç«¯å±‚ (Browser)              â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚  Pages (App Router)              â”‚   â”‚
        â”‚  â”‚  - / (Landing)                   â”‚   â”‚
        â”‚  â”‚  - /generate (è¯é¢˜ç”Ÿæˆ)           â”‚   â”‚
        â”‚  â”‚  - /confidence (ä¿¡å¿ƒè¯„ä¼°)         â”‚   â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚  Components                       â”‚   â”‚
        â”‚  â”‚  - UI (shadcn/ui)                â”‚   â”‚
        â”‚  â”‚  - Business (icebreaker, etc)    â”‚   â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚  Client Storage                   â”‚   â”‚
        â”‚  â”‚  - LocalStorage (å†å²è®°å½•)        â”‚   â”‚
        â”‚  â”‚  - Client-side è¯„åˆ†ç®—æ³•           â”‚   â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ HTTPS
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚          APIå±‚ (Next.js API Routes)     â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚  /api/generate-icebreaker        â”‚   â”‚
        â”‚  â”‚  - 3-retryæŒ‡æ•°é€€é¿                â”‚   â”‚
        â”‚  â”‚  - Promptå·¥ç¨‹                     â”‚   â”‚
        â”‚  â”‚  - JSONå“åº”è§£æ                   â”‚   â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚  /api/confidence-score           â”‚   â”‚
        â”‚  â”‚  - æ··åˆè¯„åˆ†ç®—æ³•                   â”‚   â”‚
        â”‚  â”‚  - è¯­ä¹‰åˆ†æ                       â”‚   â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚  /api/test-deepseek              â”‚   â”‚
        â”‚  â”‚  - å¥åº·æ£€æŸ¥                       â”‚   â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ HTTPS (OpenAI-compatible)
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚          AIæœåŠ¡å±‚                        â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚  DeepSeek API                    â”‚   â”‚
        â”‚  â”‚  - Model: deepseek-chat          â”‚   â”‚
        â”‚  â”‚  - Endpoint: newapi.deepwisdom   â”‚   â”‚
        â”‚  â”‚  - JSON mode                     â”‚   â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç³»ç»Ÿç‰¹ç‚¹

- **Serverlessæ¶æ„**: Next.js API Routeséƒ¨ç½²åœ¨Vercel Edge Functions
- **æ··åˆè®¡ç®—**: å®¢æˆ·ç«¯è¯„åˆ†(<50ms) + æœåŠ¡ç«¯AIåˆ†æ(~2s)
- **æ— æ•°æ®åº“**: LocalStorageå­˜å‚¨å†å²è®°å½•ï¼ˆMVPé˜¶æ®µï¼‰
- **AIé©±åŠ¨**: DeepSeekå¤§è¯­è¨€æ¨¡å‹æä¾›æ ¸å¿ƒèƒ½åŠ›
- **å“åº”å¼**: Tailwind CSS + Framer MotionåŠ¨ç”»

---

## æŠ€æœ¯æ ˆ

### å‰ç«¯æŠ€æœ¯

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” | é€‰å‹ç†ç”± |
|------|------|------|----------|
| **Next.js** | 16.0 | Reactå…¨æ ˆæ¡†æ¶ | App Routeræ¶æ„ï¼ŒSSR/SSGæ”¯æŒï¼ŒAPI Routes |
| **TypeScript** | 5.0 | ç±»å‹ç³»ç»Ÿ | ç±»å‹å®‰å…¨ï¼Œé™ä½è¿è¡Œæ—¶é”™è¯¯ |
| **Tailwind CSS** | 3.x | æ ·å¼æ¡†æ¶ | å®ç”¨ä¼˜å…ˆï¼Œå¿«é€Ÿå¼€å‘ï¼Œä½“ç§¯å° |
| **shadcn/ui** | Latest | ç»„ä»¶åº“ | åŸºäºRadix UIï¼Œå¯å¤åˆ¶ç²˜è´´ï¼Œæ— ä¾èµ–é”å®š |
| **Framer Motion** | 11.x | åŠ¨ç”»åº“ | å£°æ˜å¼APIï¼ŒSpring Physicsï¼Œæ€§èƒ½ä¼˜ç§€ |
| **Sonner** | Latest | Toasté€šçŸ¥ | è½»é‡çº§ï¼Œæ ·å¼ä¼˜é›…ï¼ŒAPIç®€æ´ |

### åç«¯æŠ€æœ¯

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” | é€‰å‹ç†ç”± |
|------|------|------|----------|
| **Next.js API Routes** | 16.0 | APIå±‚ | ä¸å‰ç«¯åŒä»“åº“ï¼Œéƒ¨ç½²ç®€å•ï¼ŒEdge Functionsæ”¯æŒ |
| **OpenAI SDK** | 4.x | AIå®¢æˆ·ç«¯ | DeepSeekå…¼å®¹OpenAIæ ¼å¼ï¼Œæˆç†Ÿç¨³å®š |
| **DeepSeek API** | v1 | å¤§è¯­è¨€æ¨¡å‹ | ä¸­æ–‡ä¼˜ç§€ï¼Œæ€§ä»·æ¯”é«˜ï¼ŒJSON modeæ”¯æŒ |

### å¼€å‘å·¥å…·

| å·¥å…· | ç”¨é€” |
|------|------|
| **ESLint** | ä»£ç æ£€æŸ¥ |
| **TypeScript Compiler** | ç±»å‹æ£€æŸ¥ |
| **Git** | ç‰ˆæœ¬æ§åˆ¶ |
| **Vercel** | éƒ¨ç½²å¹³å° |

---

## æ¶æ„å†³ç­–

### ADR-001: é€‰æ‹©DeepSeekè€ŒéOpenAI

**å†³ç­–**: ä½¿ç”¨DeepSeek APIä½œä¸ºæ ¸å¿ƒAIæœåŠ¡

**ç†ç”±**:
1. **æˆæœ¬**: DeepSeekä»·æ ¼ä»…ä¸ºOpenAIçš„1/10
2. **ä¸­æ–‡èƒ½åŠ›**: ä¸­æ–‡ç†è§£å’Œç”Ÿæˆæ›´è‡ªç„¶
3. **å…¼å®¹æ€§**: å®Œå…¨å…¼å®¹OpenAIæ ¼å¼ï¼Œåˆ‡æ¢æˆæœ¬ä½
4. **JSON Mode**: åŸç”Ÿæ”¯æŒç»“æ„åŒ–è¾“å‡º
5. **ç¨³å®šæ€§**: å®æµ‹æˆåŠŸç‡>95%

**æƒè¡¡**:
- æ”¾å¼ƒï¼šOpenAIçš„å“ç‰Œè®¤çŸ¥åº¦
- è·å¾—ï¼šæ›´ä½æˆæœ¬ã€æ›´å¥½çš„ä¸­æ–‡æ•ˆæœ

---

### ADR-002: LocalStorageè€Œéæ•°æ®åº“

**å†³ç­–**: MVPé˜¶æ®µä½¿ç”¨LocalStorageå­˜å‚¨å†å²è®°å½•

**ç†ç”±**:
1. **å¼€å‘é€Ÿåº¦**: 0é…ç½®ï¼Œç«‹å³å¯ç”¨
2. **æˆæœ¬**: æ— æœåŠ¡å™¨æˆæœ¬
3. **éšç§**: æ•°æ®å®Œå…¨åœ¨å®¢æˆ·ç«¯ï¼Œæ— éšç§é£é™©
4. **è¶³å¤ŸMVP**: 50æ¡è®°å½•è¶³å¤ŸéªŒè¯äº§å“

**é™åˆ¶**:
- æ— æ³•è·¨è®¾å¤‡åŒæ­¥
- æ— æ³•å¤šç”¨æˆ·åä½œ
- æ¸…é™¤æµè§ˆå™¨æ•°æ®ä¼šä¸¢å¤±

**æœªæ¥æ–¹å‘**: 
- Day 10+ï¼šå¼•å…¥Supabaseæˆ–Firebase
- ä¿ç•™LocalStorageä½œä¸ºç¦»çº¿æ¨¡å¼

---

### ADR-003: æ··åˆè¯„åˆ†ç®—æ³•

**å†³ç­–**: å®¢æˆ·ç«¯30% + æœåŠ¡ç«¯70%çš„æ··åˆè¯„åˆ†ç­–ç•¥

**ç†ç”±**:
1. **å¿«é€Ÿåé¦ˆ**: å®¢æˆ·ç«¯<50msï¼Œç”¨æˆ·ç«‹å³çœ‹åˆ°åˆæ­¥åˆ†æ•°
2. **æ·±åº¦åˆ†æ**: æœåŠ¡ç«¯è¯­ä¹‰ç†è§£ï¼Œæä¾›ä¸“ä¸šå»ºè®®
3. **é™ä½æˆæœ¬**: å®¢æˆ·ç«¯è¿‡æ»¤æ˜æ˜¾ä½è´¨é‡å†…å®¹ï¼Œå‡å°‘APIè°ƒç”¨
4. **æ¸è¿›å¼UX**: åˆ†æ•°ä»å®¢æˆ·ç«¯â†’æœ€ç»ˆåˆ†æ•°ï¼ŒåŠ¨ç”»è¿‡æ¸¡

**å®ç°**:
```typescript
å®¢æˆ·ç«¯è¯„åˆ† (ç«‹å³æ˜¾ç¤º)
â”œâ”€â”€ é•¿åº¦è¯„åˆ† (40%): 10-200å­—æœ€ä¼˜
â””â”€â”€ æ¨¡å¼è¯„åˆ† (60%): ç¦ç”¨è¯æ£€æµ‹ + ç§¯ææ¨¡å¼

æœåŠ¡ç«¯è¯„åˆ† (~2s)
â”œâ”€â”€ çœŸè¯šåº¦ (25%)
â”œâ”€â”€ åˆ›æ„æ€§ (25%)
â”œâ”€â”€ ç›¸å…³æ€§ (25%)
â””â”€â”€ æˆåŠŸç‡ (25%)

æœ€ç»ˆåˆ†æ•° = å®¢æˆ·ç«¯30% + æœåŠ¡ç«¯æˆåŠŸç‡70%
```

---

### ADR-004: 3-RetryæŒ‡æ•°é€€é¿

**å†³ç­–**: APIè°ƒç”¨å¤±è´¥æ—¶ä½¿ç”¨1s/2s/4sæŒ‡æ•°é€€é¿é‡è¯•

**ç†ç”±**:
1. **æé«˜æˆåŠŸç‡**: ä¸´æ—¶ç½‘ç»œæŠ–åŠ¨ä¸ä¼šå¯¼è‡´å¤±è´¥
2. **ç”¨æˆ·ä½“éªŒ**: ç”¨æˆ·æ— éœ€æ‰‹åŠ¨é‡è¯•
3. **é¿å…é›ªå´©**: æŒ‡æ•°é€€é¿é˜²æ­¢åŒæ—¶é‡è¯•

**å®ç°**:
```typescript
async function retryWithBackoff<T>(
  fn: () => Promise<T>,
  maxRetries: number = 3,
  baseDelay: number = 1000
): Promise<T> {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await fn();
    } catch (error) {
      if (i === maxRetries - 1) throw error;
      const delay = baseDelay * Math.pow(2, i);
      await new Promise(resolve => setTimeout(resolve, delay));
    }
  }
  throw new Error('Max retries exceeded');
}
```

---

### ADR-005: App Routerè€ŒéPages Router

**å†³ç­–**: ä½¿ç”¨Next.js 16 App Routeræ¶æ„

**ç†ç”±**:
1. **è¶‹åŠ¿**: App Routeræ˜¯Next.jsæœªæ¥æ–¹å‘
2. **Server Components**: é»˜è®¤æœåŠ¡ç«¯æ¸²æŸ“ï¼Œæ€§èƒ½æ›´å¥½
3. **å¸ƒå±€ç³»ç»Ÿ**: åµŒå¥—å¸ƒå±€æ›´çµæ´»
4. **å¹¶è¡Œè·¯ç”±**: æ”¯æŒå¤æ‚çš„UIæ¨¡å¼

**å­¦ä¹ æˆæœ¬**:
- éœ€è¦ç†è§£Server/Client ComponentåŒºåˆ†
- `'use client'`å£°æ˜å¿…é¡»æ˜¾å¼æ·»åŠ 

---

## æ ¸å¿ƒæ¨¡å—

### 1. è¯é¢˜ç”Ÿæˆæ¨¡å—

**ä½ç½®**: `app/api/generate-icebreaker/route.ts`

**åŠŸèƒ½**: æ ¹æ®ç”¨æˆ·å…´è¶£å’Œé£æ ¼ç”Ÿæˆ3ä¸ªç ´å†°è¯é¢˜

**æµç¨‹**:
```
ç”¨æˆ·è¾“å…¥
  â”œâ”€â”€ å…´è¶£æ ‡ç­¾ (1-5ä¸ª)
  â”œâ”€â”€ Profileè¡¥å…… (å¯é€‰)
  â””â”€â”€ å¯¹è¯é£æ ¼ (humorous/sincere/curious)
        â†“
  Promptå·¥ç¨‹
  â”œâ”€â”€ System Prompt: è§’è‰²å®šä½ + è¾“å‡ºæ ¼å¼
  â””â”€â”€ User Prompt: å…·ä½“éœ€æ±‚
        â†“
  DeepSeek APIè°ƒç”¨
  â”œâ”€â”€ Model: deepseek-chat
  â”œâ”€â”€ Temperature: 0.8 (é«˜åˆ›æ„æ€§)
  â”œâ”€â”€ Max Tokens: 1500
  â””â”€â”€ JSON Mode: å¼ºåˆ¶ç»“æ„åŒ–è¾“å‡º
        â†“
  3-RetryæŒ‡æ•°é€€é¿
  â”œâ”€â”€ ç¬¬1æ¬¡å¤±è´¥ â†’ ç­‰å¾…1s â†’ é‡è¯•
  â”œâ”€â”€ ç¬¬2æ¬¡å¤±è´¥ â†’ ç­‰å¾…2s â†’ é‡è¯•
  â””â”€â”€ ç¬¬3æ¬¡å¤±è´¥ â†’ ç­‰å¾…4s â†’ æŠ›å‡ºé”™è¯¯
        â†“
  å“åº”è§£æ
  â”œâ”€â”€ JSON.parse()
  â”œâ”€â”€ ç±»å‹éªŒè¯
  â””â”€â”€ è¿”å›3ä¸ªIcebreakerTopicå¯¹è±¡
        â†“
  å®¢æˆ·ç«¯å¤„ç†
  â”œâ”€â”€ å±•ç¤ºTopicCardç»„ä»¶
  â”œâ”€â”€ ä¿å­˜åˆ°LocalStorage
  â””â”€â”€ æ˜¾ç¤ºæˆåŠŸToast
```

**å…³é”®ä»£ç **:
```typescript
// lib/prompts/topic.ts
export function buildTopicSystemPrompt(): string {
  return `ä½ æ˜¯ä¸€ä½ç¤¾äº¤ç ´å†°ä¸“å®¶...`;
}

// app/api/generate-icebreaker/route.ts
export async function POST(request: Request) {
  const { interests, profileInfo, style } = await request.json();
  
  const response = await retryWithBackoff(() =>
    getClient().chat.completions.create({
      model: 'deepseek-chat',
      messages: [
        { role: 'system', content: buildTopicSystemPrompt() },
        { role: 'user', content: buildTopicUserPrompt({ interests, profileInfo, style }) }
      ],
      temperature: 0.8,
      max_tokens: 1500,
      response_format: { type: 'json_object' }
    })
  );

  const topics = parseTopicResponse(response.choices[0].message.content);
  return Response.json({ success: true, topics });
}
```

---

### 2. ä¿¡å¿ƒè¯„åˆ†æ¨¡å—

**ä½ç½®**: `app/api/confidence-score/route.ts`

**åŠŸèƒ½**: è¯„ä¼°ç”¨æˆ·å¼€åœºç™½çš„å‘é€æˆåŠŸç‡

**åŒå±‚æ¶æ„**:

#### å®¢æˆ·ç«¯è¯„åˆ† (lib/scoring/client.ts)
```typescript
export function calculateClientScore(message: string): ClientScoreResult {
  const length = message.length;
  
  // é•¿åº¦è¯„åˆ† (40%)
  let lengthScore = 0;
  if (length < 10) lengthScore = 20;
  else if (length >= 10 && length <= 200) lengthScore = 100;
  else lengthScore = Math.max(0, 100 - (length - 200) * 0.5);

  // æ¨¡å¼è¯„åˆ† (60%)
  let patternScore = 60;
  const violations: string[] = [];
  const positives: string[] = [];

  // ç¦ç”¨è¯æ£€æµ‹ (-30åˆ†)
  const bannedPatterns = {
    aggressive: /ç¾å¥³|çº¦å—|ç§èŠ|wx|å¾®ä¿¡|äº¤ä¸ªæœ‹å‹/gi,
    generic: /åœ¨å—|å¹²å˜›|ä½ å¥½|å—¨/gi,
    excessive: /ï¼{3,}|ï¼Ÿ{3,}|\.{3,}/g
  };

  for (const [category, pattern] of Object.entries(bannedPatterns)) {
    if (pattern.test(message)) {
      patternScore -= 30;
      violations.push(`åŒ…å«${category}æ¨¡å¼`);
    }
  }

  // ç§¯ææ¨¡å¼æ£€æµ‹ (+20åˆ†)
  const positivePatterns = {
    shared_interest: /çœ‹åˆ°ä½ ä¹Ÿåœ¨|åˆ·åˆ°ä½ çš„|æˆ‘ä¹Ÿå–œæ¬¢/gi,
    specific_detail: /\d+|å…·ä½“çš„/gi,
    open_question: /å—\ï¼Ÿ|å‘¢\ï¼Ÿ|ï¼Ÿ$/gi
  };

  for (const [category, pattern] of Object.entries(positivePatterns)) {
    if (pattern.test(message)) {
      patternScore += 20;
      positives.push(`åŒ…å«${category}æ¨¡å¼`);
    }
  }

  return {
    totalScore: lengthScore * 0.4 + patternScore * 0.6,
    lengthScore,
    patternScore,
    violations,
    positives
  };
}
```

#### æœåŠ¡ç«¯è¯„åˆ† (app/api/confidence-score/route.ts)
```typescript
async function getSemanticScore(request: SemanticScoreRequest): Promise<SemanticScoreResponse> {
  const response = await getClient().chat.completions.create({
    model: 'deepseek-chat',
    messages: [
      { role: 'system', content: buildSemanticScoreSystemPrompt() },
      { role: 'user', content: buildSemanticScoreUserPrompt(request) }
    ],
    temperature: 0.3,  // ä½æ¸©åº¦ï¼Œç¨³å®šè¾“å‡º
    max_tokens: 800,
    response_format: { type: 'json_object' }
  });

  return parseSemanticScoreResponse(response.choices[0].message.content);
}
```

**æ··åˆç­–ç•¥**:
```typescript
// æœ€ç»ˆåˆ†æ•° = å®¢æˆ·ç«¯30% + æœåŠ¡ç«¯æˆåŠŸç‡70%
const finalScore = Math.round(
  clientScore.totalScore * 0.3 + 
  semanticScore.successRate * 0.7
);
```

---

### 3. å†å²è®°å½•æ¨¡å—

**ä½ç½®**: `lib/storage/history.ts`

**åŠŸèƒ½**: ç®¡ç†è¯é¢˜ç”Ÿæˆå’Œä¿¡å¿ƒè¯„åˆ†çš„å†å²è®°å½•

**æ•°æ®ç»“æ„**:
```typescript
// è¯é¢˜ç”Ÿæˆå†å²
export interface TopicHistoryItem {
  id: string;                     // å”¯ä¸€ID (timestamp + random)
  timestamp: number;              // Unixæ—¶é—´æˆ³
  interests: string[];            // å…´è¶£æ ‡ç­¾
  style: ConversationStyle;       // å¯¹è¯é£æ ¼
  topics: IcebreakerTopic[];      // ç”Ÿæˆçš„3ä¸ªè¯é¢˜
  selectedTopic?: IcebreakerTopic; // ç”¨æˆ·é€‰ä¸­çš„è¯é¢˜
}

// ä¿¡å¿ƒè¯„åˆ†å†å²
export interface ConfidenceHistoryItem {
  id: string;
  timestamp: number;
  message: string;                  // ç”¨æˆ·è¾“å…¥çš„å¼€åœºç™½
  result: ConfidenceScoreResponse;  // å®Œæ•´è¯„åˆ†ç»“æœ
}
```

**æ ¸å¿ƒåŠŸèƒ½**:
```typescript
// 1. æ·»åŠ è®°å½•ï¼ˆè‡ªåŠ¨å‰ªæï¼‰
export function addTopicHistory(
  interests: string[],
  style: ConversationStyle,
  topics: IcebreakerTopic[]
): string {
  const history = getTopicHistory();
  const newItem: TopicHistoryItem = {
    id: generateId(),
    timestamp: Date.now(),
    interests,
    style,
    topics
  };
  history.unshift(newItem);  // æœ€æ–°åœ¨å‰
  if (history.length > MAX_HISTORY_ITEMS) {  // 50æ¡é™åˆ¶
    history.splice(MAX_HISTORY_ITEMS);
  }
  safeSetLocalStorage(TOPIC_HISTORY_KEY, history);
  return newItem.id;
}

// 2. ç»Ÿè®¡æ•°æ®
export function getTopicStats(): TopicStats {
  const history = getTopicHistory();
  return {
    totalGenerated: history.length,
    totalTopics: history.reduce((sum, item) => sum + item.topics.length, 0),
    selectedCount: history.filter(item => item.selectedTopic).length,
    styleBreakdown: {
      humorous: history.filter(item => item.style === 'humorous').length,
      sincere: history.filter(item => item.style === 'sincere').length,
      curious: history.filter(item => item.style === 'curious').length
    }
  };
}
```

**SSRå®‰å…¨**:
```typescript
function safeGetLocalStorage<T>(key: string, defaultValue: T): T {
  if (typeof window === 'undefined') return defaultValue;  // SSRæ£€æŸ¥
  try {
    const item = localStorage.getItem(key);
    return item ? JSON.parse(item) : defaultValue;
  } catch (error) {
    console.error(`Failed to read localStorage key "${key}":`, error);
    return defaultValue;
  }
}
```

---

## æ•°æ®æµ

### è¯é¢˜ç”Ÿæˆæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·äº¤äº’                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  generate/page.tsx                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  1. ç”¨æˆ·é€‰æ‹©å…´è¶£æ ‡ç­¾ (InterestInput)                â”‚     â”‚
â”‚  â”‚  2. é€‰æ‹©å¯¹è¯é£æ ¼ (humorous/sincere/curious)        â”‚     â”‚
â”‚  â”‚  3. å¯é€‰å¡«å†™profileè¡¥å……ä¿¡æ¯                         â”‚     â”‚
â”‚  â”‚  4. ç‚¹å‡»"ç”Ÿæˆç ´å†°è¯é¢˜"æŒ‰é’®                          â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼ fetch('/api/generate-icebreaker')
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Route: /api/generate-icebreaker/route.ts               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  1. éªŒè¯è¾“å…¥å‚æ•°                                    â”‚     â”‚
â”‚  â”‚  2. æ„å»ºSystem Prompt + User Prompt                â”‚     â”‚
â”‚  â”‚  3. è°ƒç”¨retryWithBackoff()                         â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼ 3-retry with backoff
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DeepSeek API                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  POST https://newapi.deepwisdom.ai/v1/chat/...    â”‚     â”‚
â”‚  â”‚  {                                                  â”‚     â”‚
â”‚  â”‚    model: "deepseek-chat",                         â”‚     â”‚
â”‚  â”‚    messages: [...],                                â”‚     â”‚
â”‚  â”‚    temperature: 0.8,                               â”‚     â”‚
â”‚  â”‚    response_format: { type: "json_object" }        â”‚     â”‚
â”‚  â”‚  }                                                  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼ JSON Response
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Route (continued)                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  1. JSON.parse(response.content)                   â”‚     â”‚
â”‚  â”‚  2. éªŒè¯topicsæ•°ç»„ç»“æ„                              â”‚     â”‚
â”‚  â”‚  3. è¿”å› { success: true, topics: [...] }         â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼ Response.json()
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  generate/page.tsx (continued)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  1. setTopics(data.topics)                         â”‚     â”‚
â”‚  â”‚  2. addTopicHistory(interests, style, topics)      â”‚     â”‚
â”‚  â”‚  3. toast.success('æˆåŠŸç”Ÿæˆ3ä¸ªç ´å†°è¯é¢˜ï¼')         â”‚     â”‚
â”‚  â”‚  4. æ¸²æŸ“3ä¸ªTopicCardç»„ä»¶                           â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LocalStorage                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Key: "icebreak_topic_history"                     â”‚     â”‚
â”‚  â”‚  Value: [                                          â”‚     â”‚
â”‚  â”‚    {                                               â”‚     â”‚
â”‚  â”‚      id: "1730448000000_abc123",                  â”‚     â”‚
â”‚  â”‚      timestamp: 1730448000000,                    â”‚     â”‚
â”‚  â”‚      interests: ["ç‹¬ç«‹éŸ³ä¹", "å’–å•¡é¦†"],           â”‚     â”‚
â”‚  â”‚      style: "sincere",                            â”‚     â”‚
â”‚  â”‚      topics: [{...}, {...}, {...}]                â”‚     â”‚
â”‚  â”‚    }                                               â”‚     â”‚
â”‚  â”‚  ]                                                 â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ä¿¡å¿ƒè¯„åˆ†æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  confidence/page.tsx - ç”¨æˆ·è¾“å…¥å¼€åœºç™½                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼ ç«‹å³æ‰§è¡Œï¼ˆå®¢æˆ·ç«¯ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  lib/scoring/client.ts                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  calculateClientScore(message)                     â”‚     â”‚
â”‚  â”‚  â”œâ”€â”€ é•¿åº¦è¯„åˆ†: 10-200å­—æœ€ä¼˜                        â”‚     â”‚
â”‚  â”‚  â”œâ”€â”€ ç¦ç”¨è¯æ£€æµ‹: -30åˆ†                             â”‚     â”‚
â”‚  â”‚  â””â”€â”€ ç§¯ææ¨¡å¼: +20åˆ†                               â”‚     â”‚
â”‚  â”‚  â†’ è¿”å›åˆæ­¥åˆ†æ•° (~10ms)                            â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼ Spring PhysicsåŠ¨ç”»æ˜¾ç¤º
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ConfidenceMeterç»„ä»¶ - æ˜¾ç¤ºå®¢æˆ·ç«¯åˆ†æ•°                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼ åŒæ—¶å‘èµ·APIè¯·æ±‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Route: /api/confidence-score/route.ts                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  1. æ¥æ”¶ { message, targetInterests?, mode }      â”‚     â”‚
â”‚  â”‚  2. è°ƒç”¨getSemanticScore()                         â”‚     â”‚
â”‚  â”‚  3. DeepSeekåˆ†æï¼ˆ~2sï¼‰                            â”‚     â”‚
â”‚  â”‚  4. è®¡ç®—æœ€ç»ˆåˆ†æ•°:                                  â”‚     â”‚
â”‚  â”‚     finalScore = clientScore*0.3 + semantic*0.7    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼ è¿”å›å®Œæ•´ç»“æœ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ConfidenceMeterç»„ä»¶ - æ›´æ–°ä¸ºæœ€ç»ˆåˆ†æ•°                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  1. åˆ†æ•°ä»å®¢æˆ·ç«¯â†’æœ€ç»ˆåˆ†æ•°ï¼ˆåŠ¨ç”»è¿‡æ¸¡ï¼‰              â”‚     â”‚
â”‚  â”‚  2. æ˜¾ç¤ºè¯¦ç»†åé¦ˆ                                    â”‚     â”‚
â”‚  â”‚     - çœŸè¯šåº¦/åˆ›æ„æ€§/ç›¸å…³æ€§/æˆåŠŸç‡                   â”‚     â”‚
â”‚  â”‚     - ä¼˜ç‚¹åˆ—è¡¨                                      â”‚     â”‚
â”‚  â”‚     - éœ€è¦æ”¹è¿›åˆ—è¡¨                                  â”‚     â”‚
â”‚  â”‚     - AIå»ºè®®                                        â”‚     â”‚
â”‚  â”‚  3. ä¿å­˜åˆ°LocalStorage                             â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## APIè®¾è®¡

### POST /api/generate-icebreaker

**åŠŸèƒ½**: ç”Ÿæˆ3ä¸ªç ´å†°è¯é¢˜

**è¯·æ±‚**:
```typescript
interface GenerateRequest {
  interests: string[];           // å¿…é€‰ï¼Œ1-5ä¸ªå…´è¶£æ ‡ç­¾
  profileInfo?: string;          // å¯é€‰ï¼Œè¡¥å……ä¿¡æ¯
  style: ConversationStyle;      // å¿…é€‰ï¼Œå¯¹è¯é£æ ¼
}
```

**å“åº”**:
```typescript
interface GenerateResponse {
  success: true;
  topics: IcebreakerTopic[];     // 3ä¸ªè¯é¢˜
  metadata?: {
    generatedAt: number;
    model: string;
  };
}
```

**é”™è¯¯**:
```typescript
{
  success: false,
  error: string,
  code?: string
}
```

---

### POST /api/confidence-score

**åŠŸèƒ½**: è¯„ä¼°å¼€åœºç™½ä¿¡å¿ƒåˆ†æ•°

**è¯·æ±‚**:
```typescript
interface ConfidenceRequest {
  message: string;               // å¿…é€‰ï¼Œç”¨æˆ·å¼€åœºç™½
  targetInterests?: string[];    // å¯é€‰ï¼Œå¯¹æ–¹å…´è¶£
  mode: 'quick' | 'full';        // å¿…é€‰ï¼Œè¯„åˆ†æ¨¡å¼
}
```

**å“åº”**:
```typescript
interface ConfidenceScoreResponse {
  finalScore: number;            // 0-100
  confidence: ConfidenceLevel;   // very-high/high/medium/low
  clientScore: ClientScoreResult;
  semanticScore?: SemanticScoreResponse;
  recommendation: string;
  processTime: number;           // ms
}
```

---

### GET /api/test-deepseek

**åŠŸèƒ½**: å¥åº·æ£€æŸ¥

**å“åº”**:
```typescript
{
  success: true,
  message: "DeepSeek APIè¿æ¥æˆåŠŸï¼",
  testResponse: string,
  model: "deepseek-chat"
}
```

---

## ç»„ä»¶å±‚çº§

### é¡µé¢ç»„ä»¶

```
app/
â”œâ”€â”€ layout.tsx                    # æ ¹å¸ƒå±€
â”‚   â”œâ”€â”€ Interå­—ä½“
â”‚   â”œâ”€â”€ Toaster (Sonner)
â”‚   â””â”€â”€ {children}
â”‚
â”œâ”€â”€ page.tsx                      # é¦–é¡µ (Landing)
â”‚   â”œâ”€â”€ Hero Section
â”‚   â”œâ”€â”€ Features Grid
â”‚   â”œâ”€â”€ CTA Buttons
â”‚   â””â”€â”€ Footer
â”‚
â”œâ”€â”€ generate/page.tsx             # è¯é¢˜ç”Ÿæˆé¡µ
â”‚   â”œâ”€â”€ PageTransition (Framer Motion)
â”‚   â”œâ”€â”€ Left Panel
â”‚   â”‚   â”œâ”€â”€ InterestInput
â”‚   â”‚   â”œâ”€â”€ ProfileInfo Textarea
â”‚   â”‚   â”œâ”€â”€ Style Selector
â”‚   â”‚   â””â”€â”€ Generate Button
â”‚   â””â”€â”€ Right Panel
â”‚       â”œâ”€â”€ TopicCardSkeletonGrid (loading)
â”‚       â”œâ”€â”€ ApiErrorState (error)
â”‚       â”œâ”€â”€ EmptyState (initial)
â”‚       â””â”€â”€ TopicCard[] (success)
â”‚
â””â”€â”€ confidence/page.tsx           # ä¿¡å¿ƒè¯„ä¼°é¡µ
    â”œâ”€â”€ PageTransition
    â”œâ”€â”€ Left Panel
    â”‚   â”œâ”€â”€ Message Textarea
    â”‚   â”œâ”€â”€ Interest Tags Input
    â”‚   â””â”€â”€ Analyze Button
    â””â”€â”€ Right Panel
        â”œâ”€â”€ ConfidenceMeter
        â”‚   â”œâ”€â”€ Score Ring (Spring Physics)
        â”‚   â”œâ”€â”€ Confidence Badge
        â”‚   â””â”€â”€ Recommendation
        â””â”€â”€ Detailed Feedback Card
            â”œâ”€â”€ Client Score
            â”œâ”€â”€ Semantic Score
            â”œâ”€â”€ Positives List
            â”œâ”€â”€ Violations List
            â””â”€â”€ AI Suggestions
```

### ç»„ä»¶ä¾èµ–å›¾

```
components/
â”œâ”€â”€ ui/                           # åŸºç¡€UIç»„ä»¶ï¼ˆshadcn/uiï¼‰
â”‚   â”œâ”€â”€ button.tsx
â”‚   â”œâ”€â”€ card.tsx
â”‚   â”œâ”€â”€ badge.tsx
â”‚   â”œâ”€â”€ input.tsx
â”‚   â”œâ”€â”€ skeleton.tsx              # Day 4æ–°å¢
â”‚   â””â”€â”€ error-state.tsx           # Day 4æ–°å¢
â”‚       â”œâ”€â”€ ErrorState
â”‚       â”œâ”€â”€ ApiErrorState
â”‚       â””â”€â”€ EmptyState
â”‚
â”œâ”€â”€ layout/                       # å¸ƒå±€ç»„ä»¶
â”‚   â””â”€â”€ PageTransition.tsx        # Day 4æ–°å¢
â”‚       â””â”€â”€ Framer MotionåŒ…è£…
â”‚
â”œâ”€â”€ icebreaker/                   # è¯é¢˜ç”Ÿæˆç»„ä»¶
â”‚   â”œâ”€â”€ InterestInput.tsx
â”‚   â”‚   â”œâ”€â”€ é¢„è®¾æ ‡ç­¾
â”‚   â”‚   â””â”€â”€ è‡ªå®šä¹‰è¾“å…¥
â”‚   â”œâ”€â”€ TopicCard.tsx
â”‚   â”‚   â”œâ”€â”€ Category + Emoji
â”‚   â”‚   â”œâ”€â”€ Opening Line
â”‚   â”‚   â”œâ”€â”€ Score Indicators
â”‚   â”‚   â”œâ”€â”€ Pros List
â”‚   â”‚   â”œâ”€â”€ Follow-ups
â”‚   â”‚   â””â”€â”€ Copy/Select Buttons
â”‚   â””â”€â”€ TopicCardSkeleton.tsx     # Day 4æ–°å¢
â”‚       â”œâ”€â”€ TopicCardSkeleton
â”‚       â””â”€â”€ TopicCardSkeletonGrid
â”‚
â””â”€â”€ confidence/                   # ä¿¡å¿ƒè¯„ä¼°ç»„ä»¶
    â””â”€â”€ ConfidenceMeter.tsx
        â”œâ”€â”€ CircularProgress (SVG)
        â”œâ”€â”€ AnimatedCounter (Spring Physics)
        â”œâ”€â”€ ConfidenceBadge
        â””â”€â”€ RecommendationText
```

---

## éƒ¨ç½²æ¶æ„

### Verceléƒ¨ç½²

```
GitHub Repository
      â”‚
      â–¼ git push
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Vercel Platform    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Build Process â”‚  â”‚
â”‚  â”‚ - npm install â”‚  â”‚
â”‚  â”‚ - next build  â”‚  â”‚
â”‚  â”‚ - ç”Ÿæˆé™æ€é¡µé¢ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚            â”‚
â”‚         â–¼            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Edge Network  â”‚  â”‚
â”‚  â”‚ - å…¨çƒCDN     â”‚  â”‚
â”‚  â”‚ - æ™ºèƒ½è·¯ç”±    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼ ç”¨æˆ·è¯·æ±‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  End Users          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç¯å¢ƒå˜é‡é…ç½®**:
```bash
# Vercel Dashboard â†’ Settings â†’ Environment Variables
DEEPSEEK_API_KEY=sk-xxx...
DEEPSEEK_API_BASE=https://newapi.deepwisdom.ai/v1  # å¯é€‰
```

**éƒ¨ç½²æµç¨‹**:
1. æ¨é€ä»£ç åˆ°GitHub mainåˆ†æ”¯
2. Vercelè‡ªåŠ¨è§¦å‘æ„å»º
3. æ„å»ºæˆåŠŸåéƒ¨ç½²åˆ°Edge Network
4. è®¿é—® `https://icebreak.vercel.app`

**æ„å»ºä¼˜åŒ–**:
- Next.jsè‡ªåŠ¨ä»£ç åˆ†å‰²
- å›¾ç‰‡ä¼˜åŒ–ï¼ˆNext/Imageï¼‰
- API Routeséƒ¨ç½²ä¸ºEdge Functions
- é™æ€é¡µé¢é¢„æ¸²æŸ“ï¼ˆSSGï¼‰

---

## æ€§èƒ½ä¼˜åŒ–

### 1. å®¢æˆ·ç«¯æ€§èƒ½

**éª¨æ¶å±åŠ è½½**:
```typescript
// æ¶ˆé™¤ç™½å±ç­‰å¾…
{loading ? (
  <TopicCardSkeletonGrid />  // ~20msæ¸²æŸ“
) : (
  <TopicCardList />
)}
```

**æ‡’åŠ è½½å›¾ç‰‡**:
```typescript
<Image 
  src="/hero.png" 
  alt="Hero" 
  loading="lazy"  // åŸç”Ÿæ‡’åŠ è½½
/>
```

**Framer Motionä¼˜åŒ–**:
```typescript
// ä½¿ç”¨transformè€Œétop/leftï¼ˆGPUåŠ é€Ÿï¼‰
animate={{ y: 0 }}  // âœ… transform: translateY()
animate={{ top: 0 }} // âŒ è§¦å‘é‡æ’
```

---

### 2. APIæ€§èƒ½

**å“åº”æ—¶é—´**:
- å®¢æˆ·ç«¯è¯„åˆ†: <50ms
- è¯é¢˜ç”Ÿæˆ: 1.5-2.5s (DeepSeekå¹³å‡)
- ä¿¡å¿ƒè¯„åˆ†: ~2s

**ä¼˜åŒ–ç­–ç•¥**:
1. **3-retryæŒ‡æ•°é€€é¿**: æé«˜æˆåŠŸç‡
2. **ä½æ¸©åº¦è¯„åˆ†**: Temperature 0.3ï¼Œç¨³å®šè¾“å‡º
3. **Max Tokensé™åˆ¶**: é¿å…è¿‡é•¿å“åº”
4. **Edge Functions**: å…¨çƒä½å»¶è¿Ÿ

---

### 3. ç¼“å­˜ç­–ç•¥

**LocalStorageç¼“å­˜**:
- å†å²è®°å½•ï¼šæ°¸ä¹…ç¼“å­˜ï¼ˆé™¤éæ¸…é™¤æµè§ˆå™¨æ•°æ®ï¼‰
- æ— éœ€é‡å¤APIè°ƒç”¨

**æœªæ¥ä¼˜åŒ–**:
- Redisç¼“å­˜ç›¸ä¼¼è¯·æ±‚
- CDNç¼“å­˜é™æ€èµ„æº
- Service Workerç¦»çº¿æ”¯æŒ

---

## å®‰å…¨è€ƒè™‘

### 1. APIå®‰å…¨

**å¯†é’¥ç®¡ç†**:
```typescript
// âœ… ä»…åœ¨æœåŠ¡ç«¯ä½¿ç”¨
const apiKey = process.env.DEEPSEEK_API_KEY;  // Server-side only

// âŒ ç¦æ­¢å®¢æˆ·ç«¯æš´éœ²
// const apiKey = 'sk-xxx';  // NEVER
```

**å»¶è¿Ÿåˆå§‹åŒ–**:
```typescript
// é¿å…æ„å»ºæ—¶æ³„éœ²
let client: OpenAI | null = null;
function getClient(): OpenAI {
  if (!client) {
    const apiKey = process.env.DEEPSEEK_API_KEY;
    if (!apiKey) throw new Error('Missing DEEPSEEK_API_KEY');
    client = new OpenAI({ apiKey });
  }
  return client;
}
```

---

### 2. è¾“å…¥éªŒè¯

**å®¢æˆ·ç«¯éªŒè¯**:
```typescript
// é•¿åº¦é™åˆ¶
<textarea maxLength={500} />

// æ ‡ç­¾æ•°é‡é™åˆ¶
if (interests.length >= 5) {
  toast.error('æœ€å¤š5ä¸ªå…´è¶£æ ‡ç­¾');
  return;
}
```

**æœåŠ¡ç«¯éªŒè¯**:
```typescript
// API Route
if (!interests || interests.length === 0) {
  return Response.json({ 
    success: false, 
    error: 'è‡³å°‘é€‰æ‹©ä¸€ä¸ªå…´è¶£æ ‡ç­¾' 
  }, { status: 400 });
}
```

---

### 3. XSSé˜²æŠ¤

**Reactè‡ªåŠ¨è½¬ä¹‰**:
```typescript
// Reactè‡ªåŠ¨è½¬ä¹‰HTML
<p>{topic.openingLine}</p>  // å®‰å…¨
```

**Dangerous HTMLç¦æ­¢**:
```typescript
// âŒ ç¦æ­¢ä½¿ç”¨
<div dangerouslySetInnerHTML={{ __html: userInput }} />
```

---

### 4. é€Ÿç‡é™åˆ¶

**æœªæ¥å®ç°**:
```typescript
// åŸºäºIPçš„é€Ÿç‡é™åˆ¶
import { Ratelimit } from '@upstash/ratelimit';

const ratelimit = new Ratelimit({
  redis: Redis.fromEnv(),
  limiter: Ratelimit.slidingWindow(10, '1 m')  // 10æ¬¡/åˆ†é’Ÿ
});
```

---

## æ€»ç»“

IceBreak AIçš„æ¶æ„è®¾è®¡éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

1. **ç®€å•ä¼˜å…ˆ**: LocalStorageè€Œéæ•°æ®åº“ï¼Œå‡å°‘å¤æ‚åº¦
2. **æ€§èƒ½ä¼˜å…ˆ**: æ··åˆè¯„åˆ†ã€éª¨æ¶å±ã€Edge Functions
3. **ç”¨æˆ·ä½“éªŒ**: æ¸è¿›å¼åé¦ˆã€é”™è¯¯é‡è¯•ã€æµç•…åŠ¨ç”»
4. **æˆæœ¬ä¼˜åŒ–**: DeepSeekè€ŒéOpenAIï¼ŒServerlesséƒ¨ç½²
5. **å¯æ‰©å±•æ€§**: æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºè¿­ä»£

**æŠ€æœ¯äº®ç‚¹**:
- æ··åˆè¯„åˆ†ç®—æ³•ï¼ˆå®¢æˆ·ç«¯+æœåŠ¡ç«¯ï¼‰
- 3-retryæŒ‡æ•°é€€é¿å®¹é”™
- Spring PhysicsåŠ¨ç”»è®¡æ•°å™¨
- LocalStorageæ™ºèƒ½ç®¡ç†
- Vercelæ„å»ºä¼˜åŒ–

**æœªæ¥æ–¹å‘**:
- Day 10+: Supabaseæ•°æ®åº“
- ç”¨æˆ·ç³»ç»Ÿï¼ˆç™»å½•/æ³¨å†Œï¼‰
- è·¨è®¾å¤‡åŒæ­¥
- ç¤¾äº¤åˆ†äº«åŠŸèƒ½
- A/Bæµ‹è¯•æ¡†æ¶

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-11-01  
**ä½œè€…**: Claude Code + Human Collaboration

ğŸ¤– Generated with Claude Code  
Co-Authored-By: Claude <noreply@anthropic.com>
